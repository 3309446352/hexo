import{B as Q}from"./d009d1dc.js";import{d as N,R as G,c as M,o as J,a2 as z,a3 as I,a4 as F,_ as O,f as h,g as _,i as t,l as y,t as o,F as H,j as K,r as R,$ as U,h as V,k as X,a5 as Y,e as q}from"./426e0fc5.js";import{C as Z}from"./76467b55.js";import"https://unpkg.com/@waline/client@v2/dist/waline.mjs";const x=N({name:"BliBliData",setup(){const a=G({wantWatch:[],watching:[],watched:[],currentTab:"watching",currentPage:1,itemsPerPage:10,totalPages:M(()=>{const s=a[a.currentTab];return Math.ceil(s.length/a.itemsPerPage)})}),n=s=>F.get("/bli",{params:{vmid:272466600,follow_status:s,type:1,pn:1,ps:10}}).then(g=>{var P,v;const r=((v=(P=g==null?void 0:g.data)==null?void 0:P.data)==null?void 0:v.total)??0;return console.log(r),g.data.data.total}).catch(g=>{throw console.error("请求失败:",g),new Error(`API调用失败: ${g.message}`)}),c=async(s,i)=>{const r=(await F.get("/bli",{params:{vmid:272466600,follow_status:s,type:1,pn:i,ps:1}})).data.data||{},{list:P=[]}=r;return P.map(u=>{var m,$,T,C,D,W,k,S,E,j,B,b,p,L,A;return{url:u.url||"",season_id:u.season_id||"",season_type_name:u.season_type_name||"",title:u.title||"无标题",evaluate:u.evaluate||"",cover:u.cover||"",stat:{follow:((m=u.stat)==null?void 0:m.follow)||0,view:(($=u.stat)==null?void 0:$.view)||0,danmaku:((T=u.stat)==null?void 0:T.danmaku)||0,reply:((C=u.stat)==null?void 0:C.reply)||0,coin:((D=u.stat)==null?void 0:D.coin)||0,series_follow:((W=u.stat)==null?void 0:W.series_follow)||0,likes:((k=u.stat)==null?void 0:k.likes)||0,favorite:((S=u.stat)==null?void 0:S.favorite)||0},new_ep:{index_show:((E=u.new_ep)==null?void 0:E.index_show)||"全12话"},areas:{id:((B=(j=u.areas)==null?void 0:j[0])==null?void 0:B.id)??0,name:((p=(b=u.areas)==null?void 0:b[0])==null?void 0:p.name)??"番剧"},rating:{score:((L=u.rating)==null?void 0:L.score)??0,count:((A=u.rating)==null?void 0:A.count)??0}}})},d=async()=>{let s=[];for(let i=1;i<=3;i++){const g=await n(i);console.log("当前状态总数据量:",g);for(let r=0;r<g;r++)i==1?(s=await c(i,r),a.watching.push(...s)):i==2?(s=await c(i,r),a.wantWatch.push(...s)):i==3&&(s=await c(i,r),a.watched.push(...s))}localStorage.setItem("BliBli-watched",JSON.stringify(I(a.watched))),localStorage.setItem("BliBli-watching",JSON.stringify(I(a.watching))),localStorage.setItem("BliBli-wantWatch",JSON.stringify(I(a.wantWatch)))},w=M(()=>{const s={watched:a.watched,watching:a.watching,wantWatch:a.wantWatch}[a.currentTab],i=(a.currentPage-1)*a.itemsPerPage,g=i+a.itemsPerPage;return s.slice(i,g)}),f=async()=>{try{const s=localStorage.getItem("BliBli-watched"),i=localStorage.getItem("BliBli-watching"),g=localStorage.getItem("BliBli-wantWatch");if(!s||!i||!g){console.log("本地存储数据不完整，开始获取远程数据..."),d();return}a.watched=JSON.parse(s),a.watching=JSON.parse(i),a.wantWatch=JSON.parse(g),a.currentTab="watching"}catch(s){console.error("本地数据解析失败，重新获取远程数据:",s),await d()}},e=s=>{a.currentTab=s,a.currentPage=1},l={goToFirstPage(){a.currentPage=1},prevPage(){a.currentPage>1&&a.currentPage--},nextPage(){a.currentPage<a.totalPages&&a.currentPage++},goToLastPage(){a.currentPage=a.totalPages}};return J(()=>{f().then(()=>{console.log("初始化加载完成")}),console.log(w.value)}),{...z(a),state:a,watchTab:w,bangumiTab:e,paginationMethods:l}}});const aa={class:"flex justify-event flex-wrap pt-2"},ta={id:"article-container"},na={class:"bangumi-tabs"},ea={id:"bangumi-item",class:"bangumi-show"},sa={class:"bangumi-picture"},oa=["src"],ia={class:"bangumi-info"},la={class:"bangumi-title"},ua=["href"],ga={class:"bangumi-meta"},ra={class:"bangumi-info-items"},ca={class:"bangumi-info-item"},da={class:"bangumi-info-total"},ma={class:"bangumi-info-item bangumi-area"},ba={class:"bangumi-info-label"},pa={class:"bangumi-info-item bangumi-play"},ha={class:"bangumi-info-item bangumi-follow"},wa={class:"bangumi-info-item bangumi-coin"},fa={class:"bangumi-info-item bangumi-danmaku"},_a={class:"bangumi-info-item bangumi-info-item-score"},Pa={class:"bangumi-comments"},va={class:"bangumi-pagination"},$a=["disabled"],Ba=["disabled"],ya={class:"bangumi-pagenum"},Ta=["disabled"],Ca=["disabled"];function Da(a,n,c,d,w,f){return h(),_("div",aa,[t("div",ta,[t("div",na,[t("a",{class:y(["bangumi-tab",{"bangumi-active":a.currentTab==="Watching"}]),id:"bangumi-tab1",onClick:n[0]||(n[0]=e=>a.bangumiTab("watching"))}," 想看"+o(a.watching.length+1),3),t("a",{class:y(["bangumi-tab",{"bangumi-active":a.currentTab==="wantWatch"}]),id:"bangumi-tab2",onClick:n[1]||(n[1]=e=>a.bangumiTab("wantWatch"))},"在看"+o(a.wantWatch.length+1),3),t("a",{class:y(["bangumi-tab",{"bangumi-active":a.currentTab==="watched"}]),id:"bangumi-tab3",onClick:n[2]||(n[2]=e=>a.bangumiTab("watched"))},"已看"+o(a.watched.length+1),3)]),t("div",null,[t("div",ea,[(h(!0),_(H,null,K(a.watchTab,(e,l)=>(h(),_("div",{class:"bangumi-item",key:e.season_id},[t("div",sa,[t("img",{src:e.cover,referrerpolicy:"no-referrer",width:"110",style:{width:"110px",margin:"20px auto"}},null,8,oa)]),t("div",ia,[t("div",la,[t("a",{target:"_blank",href:e.url},o(e.title),9,ua)]),t("div",ga,[t("span",ra,[t("span",ca,[t("span",da,o(e.new_ep.index_show),1),n[7]||(n[7]=t("em",{class:"bangumi-info-label-em"},"0",-1))]),t("span",ma,[t("span",ba,o(e.season_type_name),1),t("em",null,o(e.areas.name),1)]),t("span",pa,[n[8]||(n[8]=t("span",{class:"bangumi-info-label"},"总播放",-1)),t("em",null,o(e.stat.view),1)]),t("span",ha,[n[9]||(n[9]=t("span",{class:"bangumi-info-label"},"追番人数",-1)),t("em",null,o(e.stat.follow)+"万",1)]),t("span",wa,[n[10]||(n[10]=t("span",{class:"bangumi-info-label"},"硬币数",-1)),t("em",null,o(e.stat.coin)+"万",1)]),t("span",fa,[n[11]||(n[11]=t("span",{class:"bangumi-info-label"},"弹幕总数",-1)),t("em",null,o(e.stat.danmaku)+"万",1)]),t("span",_a,[n[12]||(n[12]=t("span",{class:"bangumi-info-label"},"评分",-1)),t("em",null,o(e.rating.score),1)])])]),t("div",Pa,[t("p",null,o(e.evaluate),1)])])]))),128)),t("div",va,[t("a",{class:"bangumi-button bangumi-firstpage",onClick:n[3]||(n[3]=(...e)=>a.paginationMethods.goToFirstPage&&a.paginationMethods.goToFirstPage(...e)),disabled:a.state.currentPage===1}," 首页",8,$a),t("a",{class:"bangumi-button bangumi-previouspage",onClick:n[4]||(n[4]=(...e)=>a.paginationMethods.prevPage&&a.paginationMethods.prevPage(...e)),disabled:a.state.currentPage===1},"上一页",8,Ba),t("span",ya,o(a.state.currentPage)+" / "+o(a.state.totalPages),1),t("a",{class:"bangumi-button bangumi-nextpage",onClick:n[5]||(n[5]=(...e)=>a.paginationMethods.nextPage&&a.paginationMethods.nextPage(...e)),disabled:a.state.currentPage===a.state.totalPages},"下一页",8,Ta),t("a",{class:"bangumi-button bangumi-lastpage",onClick:n[6]||(n[6]=(...e)=>a.paginationMethods.goToLastPage&&a.paginationMethods.goToLastPage(...e)),disabled:a.state.currentPage===a.state.totalPages},"尾页",8,Ca)])])])])])}const Wa=O(x,[["render",Da]]),ka=N({name:"BangumisData",setup(){const a=G({wantWatch:[],watching:[],watched:[],currentTab:"watching",currentPage:1,itemsPerPage:10,totalPages:M(()=>{const l=a[a.currentTab];return Math.ceil(l.length/a.itemsPerPage)})}),n=M(()=>{const l={watched:a.watched,watching:a.watching,wantWatch:a.wantWatch}[a.currentTab],s=(a.currentPage-1)*a.itemsPerPage,i=s+a.itemsPerPage;return l.slice(s,i)}),c=l=>{a.currentTab=l,a.currentPage=1},d={goToFirstPage(){a.currentPage=1},prevPage(){a.currentPage>1&&a.currentPage--},nextPage(){a.currentPage<a.totalPages&&a.currentPage++},goToLastPage(){a.currentPage=a.totalPages}},w=async()=>{try{const l=localStorage.getItem("watched"),s=localStorage.getItem("watching"),i=localStorage.getItem("wantWatch");if(!l||!s||!i){console.log("本地存储数据不完整，开始获取远程数据..."),await f();return}a.watched=JSON.parse(l),a.watching=JSON.parse(s),a.wantWatch=JSON.parse(i),a.currentTab="watching"}catch(l){console.error("本地数据解析失败，重新获取远程数据:",l),await f()}},f=async()=>{let l=0,s=0;const i=20,g=localStorage.getItem("vmid");g==null&&localStorage.setItem("vmid"," ");do{const v=await F.get(`https://api.bgm.tv/v0/users/${g}/collections?subject_type=2&limit=${i}&offset=${l}`),u=v.data.data;s=v.data.total;for(const m of u)try{const{subject:{short_summary:$,images:T,score:C,eps:D,name:W,name_cn:k},subject_id:S,subject_type:E}=m,j=await e(m.subject_id),B={subject_info:{short_summary:$,images:T,score:C,eps:D,name:W,name_cn:k},collection_info:j,subject_id:S,subject_type:E};m.type===1?(a.wantWatch.push(B),a.wantWatch.sort((b,p)=>p.updated_at-b.updated_at)):m.type===3?(a.watching.push(B),a.watching.sort((b,p)=>p.updated_at-b.updated_at)):m.type===2&&(a.watched.push(B),a.watched.sort((b,p)=>p.updated_at-b.updated_at))}catch($){console.error(`处理条目失败: subject_id=${m.subject_id}`,$)}l+=i}while(l<s);const r=a.wantWatch.length+a.watching.length+a.watched.length,P=s-r;return console.log(`Generated bangumis.json, total ${s} bangumis, ${r} succeed, ${P} failed`),console.log(a.watched,a.watching,a.watched),localStorage.setItem("watched",JSON.stringify(a.watched)),localStorage.setItem("watching",JSON.stringify(a.watching)),localStorage.setItem("wantWatch",JSON.stringify(a.wantWatch)),console.log(a.watched,a.watching,a.wantWatch),{watchTab:n}},e=async l=>(await F.get(`https://api.bgm.tv/subject/${l}`)).data.collection;return J(()=>{w().then(()=>{console.log("初始化加载完成")})}),{...z(a),bangumiTab:c,watchTab:n,paginationMethods:d,state:a}}});const Sa={class:"flex justify-event flex-wrap pt-2"},Ea={id:"article-container"},ja={class:"bangumi-tabs"},Ma={id:"bangumi-item",class:"bangumi-show"},Fa={class:"bangumi-picture"},Ia=["src"],Na={class:"bangumi-info"},Ja={class:"bangumi-title"},Oa=["href"],La={class:"bangumi-meta"},Aa={class:"bangumi-info-items"},Ra={class:"bangumi-info-item"},Va={class:"bangumi-info-total"},qa={class:"bangumi-info-item bangumi-play"},Ga={class:"bangumi-info-item bangumi-follow"},za={class:"bangumi-info-item bangumi-coin"},Ha={class:"bangumi-info-item bangumi-coin"},Ka={class:"bangumi-info-item bangumi-coin"},Qa={class:"bangumi-comments"},Ua={class:"bangumi-pagination"},Xa=["disabled"],Ya=["disabled"],Za={class:"bangumi-pagenum"},xa=["disabled"],at=["disabled"];function tt(a,n,c,d,w,f){return h(),_("div",Sa,[t("div",Ea,[t("div",ja,[t("a",{class:y(["bangumi-tab",{"bangumi-active":a.currentTab==="wantWatch"}]),id:"bangumi-tab1",onClick:n[0]||(n[0]=e=>a.bangumiTab("wantWatch"))}," 想看"+o(a.wantWatch.length),3),t("a",{class:y(["bangumi-tab",{"bangumi-active":a.currentTab==="watching"}]),id:"bangumi-tab2",onClick:n[1]||(n[1]=e=>a.bangumiTab("watching"))},"在看"+o(a.watching.length),3),t("a",{class:y(["bangumi-tab",{"bangumi-active":a.currentTab==="watched"}]),id:"bangumi-tab3",onClick:n[2]||(n[2]=e=>a.bangumiTab("watched"))},"已看"+o(a.watched.length),3)]),t("div",null,[t("div",Ma,[(h(!0),_(H,null,K(a.watchTab,(e,l)=>(h(),_("div",{class:"bangumi-item",key:l},[t("div",Fa,[t("img",{src:e.subject_info.images.common,referrerpolicy:"no-referrer",width:"110",style:{width:"110px",margin:"20px auto"}},null,8,Ia)]),t("div",Na,[t("div",Ja,[t("a",{target:"_blank",href:`https://bangumi.tv/subject/${e.subject_id}`},o(e.subject_info.name_cn||e.subject_info.name),9,Oa)]),t("div",La,[t("span",Aa,[t("span",Ra,[t("span",Va," 全"+o(e.subject_info.eps)+"话",1),n[7]||(n[7]=t("em",{class:"bangumi-info-label-em"},"0",-1))]),n[13]||(n[13]=t("span",{class:"bangumi-info-item bangumi-area"},[t("span",{class:"bangumi-info-label"},"类型"),t("em",null,"中国大陆")],-1)),t("span",qa,[n[8]||(n[8]=t("span",{class:"bangumi-info-label"},"想看",-1)),t("em",null,o(e.collection_info.wish),1)]),t("span",Ga,[n[9]||(n[9]=t("span",{class:"bangumi-info-label"},"在看",-1)),t("em",null,o(e.collection_info.doing)+"万",1)]),t("span",za,[n[10]||(n[10]=t("span",{class:"bangumi-info-label"},"已看",-1)),t("em",null,o(e.collection_info.collect),1)]),t("span",Ha,[n[11]||(n[11]=t("span",{class:"bangumi-info-label"},"搁置",-1)),t("em",null,o(e.collection_info.on_hold)+"万",1)]),t("span",Ka,[n[12]||(n[12]=t("span",{class:"bangumi-info-label"},"评分",-1)),t("em",null,o(e.subject_info.score),1)])])]),t("div",Qa,[t("p",null,o(e.subject_info.short_summary),1)])])]))),128)),t("div",Ua,[t("a",{class:"bangumi-button bangumi-firstpage",onClick:n[3]||(n[3]=(...e)=>a.paginationMethods.goToFirstPage&&a.paginationMethods.goToFirstPage(...e)),disabled:a.state.currentPage===1}," 首页",8,Xa),t("a",{class:"bangumi-button bangumi-previouspage",onClick:n[4]||(n[4]=(...e)=>a.paginationMethods.prevPage&&a.paginationMethods.prevPage(...e)),disabled:a.state.currentPage===1},"上一页",8,Ya),t("span",Za,o(a.state.currentPage)+" / "+o(a.state.totalPages),1),t("a",{class:"bangumi-button bangumi-nextpage",onClick:n[5]||(n[5]=(...e)=>a.paginationMethods.nextPage&&a.paginationMethods.nextPage(...e)),disabled:a.state.currentPage===a.state.totalPages},"下一页",8,xa),t("a",{class:"bangumi-button bangumi-lastpage",onClick:n[6]||(n[6]=(...e)=>a.paginationMethods.goToLastPage&&a.paginationMethods.goToLastPage(...e)),disabled:a.state.currentPage===a.state.totalPages},"尾页",8,at)])])])])])}const nt=O(ka,[["render",tt]]);const et=N({name:"BanGumis",components:{Comment:Z,BangumisData:nt,BliBliData:Wa,Breadcrumbs:Q},setup(){const a=R("BangumisData");function n(){a.value=a.value==="BangumisData"?"BangumisData":"BliBliData"}const c="追番",d=R(new U);return J(()=>{}),{pageTitle:c,ChangeComponent:n,choseComponent:a,pageData:d}}}),st={class:"post-header"},ot={class:"post-title text-white uppercase"},it={class:"bg-ob-deep-800 rounded-2xl shadow-xl block",style:{"padding-top":"1rem","padding-bottom":"1rem","padding-left":"2.5rem","padding-right":"2.5rem"}};function lt(a,n,c,d,w,f){const e=q("Breadcrumbs"),l=q("Comment");return h(),_("div",null,[t("div",st,[V(e,{current:a.pageTitle},null,8,["current"]),t("h1",ot,o(a.pageTitle),1)]),t("div",it,[t("blockquote",{onClick:n[0]||(n[0]=(...s)=>a.ChangeComponent&&a.ChangeComponent(...s))},n[1]||(n[1]=[t("p",null,"生命不息，追番不止！",-1)])),(h(),X(Y(a.choseComponent)))]),V(l,{title:a.pageData.title,body:a.pageData.text,uid:a.pageData.uid},null,8,["title","body","uid"])])}const dt=O(et,[["render",lt]]);export{dt as default};
